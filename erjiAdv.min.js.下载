/**
 * @file erjiAdv.js
 * @author xxx
 * @date 2015-12-28
 * @desc for hao123
 */
(function () {
var browser = navigator.appName
var b_version = navigator.appVersion
var version = b_version.split(";");
var trim_Version = version && version[1] && version[1].replace(/[ ]/g, "");
var ieVersion;
if (browser == "Microsoft Internet Explorer" && trim_Version == "MSIE6.0") {
    ieVersion = 6;
} else if (browser == "Microsoft Internet Explorer" && trim_Version == "MSIE7.0") {
    ieVersion = 7;
} else if (browser == "Microsoft Internet Explorer" && trim_Version == "MSIE8.0") {
    ieVersion = 8;
} else if (browser == "Microsoft Internet Explorer" && trim_Version == "MSIE9.0") {
    ieVersion = 9;
}

var HAO = window.HAO || {};

var timer = setInterval(function () {
    if (window.$ || window.jQuery) {
        clearInterval(timer);
        (function ($) {
            function styleFORVideoSub() {
                var cssText = ''
                + '.hao123 #header.hdmini .header-hd-wrapper{position: static;}'
                + '.hao123 #header.hdmini.header-hdmini{margin-bottom:20px;}'
                + '.hao123 #topbar.hdmini.topbar-hdmini{position:static;}'
                + '.hao123 #topbar.hdmini .inner{line-height:0;}'
                + '.hao123 #header.hdmini .header-hd-inner {width:1235px;' + (ieVersion == 8 ? 'top:-48px;': '')+'}'
                domClass.createStyleElem(cssText);
            }
            function styleFORVideo() {
                var cssText = ''
                + '.hao123 #header.hdmini .header-hd-wrapper{position: static;}'
                + '.hao123 #header.hdmini .header-hd-wrapper .hd-inner{z-index:999;}'
                + '.hao123 #topbar.hdmini.topbar-hdmini{position:static;}'
                + '.hao123 .top-sub-nav-mini{position:relative;top:0;min-width: 1000px;}'
                + '.hao123 #header.hdmini .header-hd-inner {width:1235px;' + (ieVersion == 8 ? 'top:-48px;': '')+'}'
                + '.hao123 #content.hao123-content {padding-top: 20px;}';
                domClass.createStyleElem(cssText);
            }
            function forVHAO123() {
                var hostname = location.hostname;
                var pathname = location.pathname;
                var pageId = window.pageId;
                if (pageId === 'page-hao123-tv-new' 
                    || pageId === 'page-hao123-movie-new'
                    || pageId === 'session-video-detail-movie-nocopyright'
                    || pageId === 'session-video-detail-movie-copyright'
                    || pageId === 'session-video-detail-tvplay'
                    || pageId === 'page-hao123-tamasha-new'
                    || pageId === 'session-video-detail-tamasha'
                    || pageId === 'session-video-detail-cartoon') {
                    styleFORVideoSub();
                    $('#header .hd-wrapper').addClass('header-hd-wrapper');
                    $('#header.hdmini').addClass('header-hdmini');
                    $('#topbar.hdmini').addClass('topbar-hdmini');

                    if (ieVersion && ieVersion === 8) {
                        $('#header .hd-inner').addClass('header-hd-inner');
                    }
                    $(window).scroll(function () {
                        if (80 <= $(window).scrollTop()) {
                            $('#header .hd-wrapper').removeClass('header-hd-wrapper');
                            $('#header.hdmini').removeClass('header-hdmini');
                            $('#topbar.hdmini').removeClass('topbar-hdmini');
                            $('#header .hd-inner').removeClass('header-hd-inner');
                        } else if ($(window).scrollTop() < 80){
                            $('#header .hd-wrapper').addClass('header-hd-wrapper');
                            $('#header.hdmini').addClass('header-hdmini');
                            $('#topbar.hdmini').addClass('topbar-hdmini');

                            if (ieVersion && ieVersion === 8) {
                                $('#header .hd-inner').addClass('header-hd-inner');
                            }
                        }
                    });
                } else if (pageId === 'page-hao123-cartoon-new') {
                    styleFORVideo();
                    $('#header .hd-wrapper').addClass('header-hd-wrapper');
                    $('#topbar.hdmini').addClass('topbar-hdmini');
                    $('.hao123 #content').addClass('hao123-content');
                    $('.top-sub-nav').addClass('top-sub-nav-mini');
                    if (ieVersion && ieVersion === 8) {
                        $('#header .hd-inner').addClass('header-hd-inner');
                    }
                    $(window).scroll(function () {
                        if (80 <= $(window).scrollTop()) {
                            $('#header .hd-wrapper').removeClass('header-hd-wrapper');
                            $('.top-sub-nav').removeClass('top-sub-nav-mini');
                            $('#topbar.hdmini').removeClass('topbar-hdmini');
                            $('.hao123 #content').removeClass('hao123-content');
                            $('#header .hd-inner').removeClass('header-hd-inner');
                        } else if ($(window).scrollTop() < 80) {
                            $('#header .hd-wrapper').addClass('header-hd-wrapper');
                            $('.top-sub-nav').addClass('top-sub-nav-mini');
                            $('#topbar.hdmini').addClass('topbar-hdmini');
                            $('.hao123 #content').addClass('hao123-content');
                            if (ieVersion && ieVersion === 8) {
                                $('#header .hd-inner').addClass('header-hd-inner');
                            }
                        }
                    });
                }
            };

            function forVHAO123HIDE() {
                var hostname = location.hostname;
                var pathname = location.pathname;
                if (pageId === 'page-hao123-tv-new' 
                    || pageId === 'page-hao123-movie-new'
                    || pageId === 'session-video-detail-movie-nocopyright'
                    || pageId === 'session-video-detail-movie-copyright'
                    || pageId === 'session-video-detail-tvplay'
                    || pageId === 'page-hao123-tamasha-new'
                    || pageId === 'session-video-detail-tamasha'
                    || pageId === 'session-video-detail-cartoon') {
                    $('#header .hd-wrapper').removeClass('header-hd-wrapper');
                    $('#header.hdmini').removeClass('header-hdmini');
                    $('#topbar.hdmini').removeClass('topbar-hdmini');
                    $('#header .hd-inner').removeClass('header-hd-inner');
                } else if (pageId === 'page-hao123-cartoon-new') {
                    $('#header .hd-wrapper').removeClass('header-hd-wrapper');
                    $('.top-sub-nav').removeClass('top-sub-nav-mini');
                    $('#topbar.hdmini').removeClass('topbar-hdmini');
                    $('.hao123 #content').removeClass('hao123-content');
                    $('#header .hd-inner').removeClass('header-hd-inner');

                }
            }
            // 修复二级新头部（灰色）固定定位时的bug
            function grayFun() {
                var $grayFixed = $('#grayFixed');
                if ($grayFixed.length > 0) {
                    var $header = $('#erjiV2Header');
                    $(window).scroll(function () {
                        if ($header.offset().top <= $(window).scrollTop()) {
                            $grayFixed.css('position', 'fixed');
                        }
                        else {
                            $grayFixed.css('position', 'static');
                        }
                    });
                }
            }

            var ICON = 'http://s0.hao123img.com/res/r/image/2016-04-11/bf6a01c31f8853f667feeeab3eced05d.png';
            var ICON = HAO.https ? HAO.httpsTrans(ICON) : ICON;
            var url = function () {
                var url = '//www.hao123.com/erjiapi/adv';
                if (location.host.indexOf('game.hao123.com') > -1) {
                    url = '//www.hao123.com/erjiapi/adv/game';
                }
                return url;
            };

            var util = {
                getCookie: function getCookie(key) {
                    var cookies = document.cookie ? document.cookie.split('; ') : [];
                    for (var i = 0, l = cookies.length; i < l; i++) {
                        var parts = cookies[i].split('=');
                        var name = decodeURIComponent(parts.shift());
                        if (key && key === name) {
                            return decodeURIComponent(parts.pop());
                        }
                    }
                },
                setCookie: function (key, value, options) {
                    key = encodeURIComponent(key);
                    value = encodeURIComponent(value);

                    options = options || {};
                    options.expires = options.expires || 1;
                    options.path = options.path || '/';
                    options.secure = options.secure || false;
                    options.domain = options.domain || '.hao123.com';

                    /* eslint-disable */
                    var cookieStr = key + '=' + value + '; expires=' + options.expires + ';path=' + options.path + (options.secure ? ';secure' : '');
                    /* eslint-disable */

                    if (options.domain != 'current') {
                        cookieStr += ';domain=' + options.domain;
                    }
                    document.cookie = cookieStr;
                },
                cookieExpires: function (options) {
                    var getCookieExpires = function (time) {
                        var keys;
                        var date;
                        var msec;
                        var now;
                        time += '';
                        if (/(-|\/)+/.test(time)) {
                            keys = time.match(/\d+/g);
                            keys[1] -= 1;
                            date = new Date(Date.UTC.apply(Date, keys));
                        }
                        else if (time.indexOf(':') > -1) {
                            keys = time.match(/\d+/g);
                            date = new Date();
                            now = date.getTime();

                            keys[0] = keys[0] === '24' ? 23 : keys[0];

                            date.setHours(keys[0]);
                            date.setMinutes(keys[1]);
                            date.setSeconds(0);
                            date.setMilliseconds(0);

                            now >= date.getTime() && (msec = date.getTime() + 24 * 3600000, date = new Date(msec));
                        }
                        else {
                            msec = parseInt(time, 10) * 24 * 3600000;

                            date = new Date();
                            date.setHours(0);
                            date.setMinutes(0);
                            date.setSeconds(0);
                            date.setMilliseconds(0);

                            date = new Date(msec + date.getTime());
                        }
                        date.setSeconds(0);
                        date.setMilliseconds(0);
                        return date.toUTCString();
                    }

                    options = options || {};
                    options.expires = getCookieExpires(options.time);
                    this.setCookie(options.key, options.value, options);
                },
                log: function (params) {
                    var param = function (params) {
                        if (typeof params === 'string') {
                            return params;
                        } else {
                            var arr = [];
                            for (var i in params) {
                                arr.push(encodeURIComponent(i) + '=' + encodeURIComponent(params[i]));
                            }
                            return arr.join('&');
                        }
                    };
                    var url = '//www.hao123.com/images/track.gif';
                    var t = new Date().getTime();
                    var i = 'img_' + t;

                    window[i] = new Image();
                    window[i].onload = window[i].onerror = function () {
                        window[i] = null;
                    };
                    window[i].src = url + '?' + param(params) + '&r=' + t;
                },
                loadImg: function (src, $container, callback) {
                    var img  = new Image();
                    img.onload = function () {
                        $container.slideDown(300, function () {
                            callback && callback();
                        });
                    };
                    img.src = HAO.https ? HAO.httpsTrans(src) : src;
                },
                getStr: function () {
                    var a = [65, 90];
                    var b = [97, 122];
                    var len = Math.floor(Math.random() * 5 + 4);
                    var list = [];
                    var random = [function(){return Math.floor(Math.random() * (a[1] - a[0] + 1) + a[0])}, function(){return Math.floor(Math.random() * (b[1] - b[0] + 1) + b[0])}];
                    do {
                        list.push(random[Math.floor(Math.random()*2)]());
                    } while (list.length < len);
                    var str = String.fromCharCode.apply(String, list);
                    return str.toLowerCase();
                }
            };

            var domClass = {
                createAElem: function (url, imgurl, title) {
                    var $a = $('<a>');
                    $a.css({
                        height: '100%',
                        width: '100%',
                        position: 'relative',
                        background: 'url(' + (HAO.https ? HAO.httpsTrans(imgurl) : imgurl)+ ') no-repeat 50% 0',
                        display: 'block'
                    })
                    .attr({
                        href: url,
                        target: '_blank',
                        title: title
                    });
                    return $a;
                },
                createSpanElem: function () {
                    var $span = $('<span>');
                    var $em = $('<em>');
                    var $i = $('<i>');
                    $span.attr('action-type', 'close').css({
                        position: 'absolute',
                        height: '29px',
                        width: '29px'
                    }).append($em).append($i);
                    $em.css({
                        display: 'inline-block',
                        height: '29px',
                        width: '29px',
                        backgroundColor: '#000',
                        opacity: .7
                    });
                    $i.css({
                        position: 'absolute',
                        top: '5px',
                        left: '5px',
                        width: '19px',
                        height: '19px',
                        zIndex: 2,
                        background: 'url(' + ICON + ') no-repeat -58px 0'
                    });
                    return $span;
                },
                createDivElem: function () {
                    var div;
                    if (arguments.length > 0) {
                        div = '<div class="' + arguments[0] + '">';
                    }
                    else {
                        div = '<div>';
                    }
                    return $(div);
                },
                createStyleElem: function (cssText) {
                    var style = document.createElement('style');
                    style.type = 'text/css';
                    try {
                        style.appendChild(document.createTextNode(cssText));
                    }
                    catch (e) {
                        style.styleSheet.cssText = cssText;
                    }
                    try {
                        document.head.appendChild(style);
                    }
                    catch (e) {
                        document.getElementsByTagName('head')[0].appendChild(style);
                    }
                }
            };

            var adv = {
                top: function (arg) {
                    if ((ieVersion && ieVersion > 6) || !ieVersion) {
                        forVHAO123();
                    }
                    if (ieVersion && ieVersion === 6 && window.pageId != 'page-hao123-index-new') {
                        $('#topbar').css('position', 'relative');
                        // $('#topbar .inner').css('position', 'absolute');
                        $('#topbar .userbar').css({
                            marginTop: 0
                        });
                    }
                    var data = arg.top.data;
                    var trackParam = arg.top.trackParam;
                    var $div = domClass.createDivElem();
                    var $a = domClass.createAElem(data.url, data.imgurl, data.title);
                    var $span = domClass.createSpanElem();
                    var id = util.getStr();

                    $span.css({
                        bottom: '25px',
                        right: '100px'
                    });
                    $div.css('min-width', '1000px').attr('id', id);
                    
                    if (0 === parseInt(data.is_fixed, 10)) {
                        $a.append($span);
                        $div.attr('data-hook', 'slide-down').css({
                            height: '80px',
                            display: 'none',
                            width: '100%',
                            backgroundColor: data.bgcolor
                        }).append($a);

                        $('body').prepend($div);
                        util.loadImg(data.imgurl, $div, grayFun);
                    }
                    else if (1 === parseInt(data.is_fixed, 10)) {
                        var $aBig = domClass.createAElem(data.url, data.big_imgurl, data.title);
                        $a.css('display', 'none').append($span);
                        $div.css({
                            height: '160px',
                            width: '100%',
                            display: 'none',
                            backgroundColor: data.bgcolor
                        }).slideDown().append($a).append($aBig);
                        
                        $('body').prepend($div);
                        util.loadImg(arg.big_imgurl, $div);
                            // console.log(123);
                        setTimeout(function() {
                            $div.animate({
                                height: 0
                            }, 'linear', function() {
                                $aBig.remove();
                                $a.css('display', 'block');
                                $div.animate({
                                    height: '80px'
                                }, 'linear');
                                grayFun();
                            });
                        }, 5000);
                    }
                    else if (2 === parseInt(data.is_fixed, 10)) {
                        var $aBig = domClass.createAElem(data.url, data.big_imgurl, data.title);
                        $a.append($span);
                        
                        $div.css({
                            height: '80px',
                            display: 'none',
                            width: '100%',
                            backgroundColor: arg.bgcolor
                        }).append($a);
                          
                        var img = new Image();
                        
                        img.onload = function() {
                            var $span = domClass.createSpanElem();
                            $span.css({
                                bottom: 0,
                                right: 0
                            });
                            var sty = {
                                position: 'fixed',
                                top: 0,
                                left: '50%',
                                zIndex: 99999,
                                width: img.width,
                                height: img.height,
                                marginLeft: -img.width / 2 + 'px'
                            }
                            if (ieVersion && ieVersion === 6) {
                                sty.position = 'absolute';
                            }
                            $aBig.css(sty).append($span);

                            $('body').append($aBig).prepend($div);

                            var timer = setTimeout(function () {
                                $aBig.remove();
                                util.loadImg(data.imgurl, $div, grayFun);
                                util.cookieExpires({
                                    key: window.pageId + '-top',
                                    value: 1,
                                    time: data.cktime
                                });
                            }, 5000);

                            $span.click(function() {
                                $aBig.remove();
                                util.loadImg(data.imgurl, $div);
                                util.cookieExpires({
                                    key: window.pageId + '-top',
                                    value: 1,
                                    time: data.cktime
                                });
                                return false;
                            });
                        }
                        img.src = data.big_imgurl;
                    }
                    $a.on('click', '[action-type=close]', function() {
                        util.log(trackParam);
                        $(this).closest('div').remove();
                        util.cookieExpires({
                            key: window.pageId + '-top',
                            value: 1,
                            time: data.cktime
                        });
                        if (ieVersion && ieVersion > 6) {
                            forVHAO123HIDE();
                        }
                        return false;
                    }).click(function() {
                        var param = $.extend({}, trackParam);
                        delete param.btnclose;
                        util.log(param);
                    });
                    if (ieVersion && ieVersion === 6) {
                        $('body').css('position', 'relative');
                        $(window).resize(function () {
                            if ($('body').width() <= 1020) {
                                $('#' + id).width(1000);
                            }
                            else {
                                $('#' + id).width('100%');
                            }
                        })
                    }
                },
                side: function (arg) {
                    // if (ieVersion && ieVersion === 6) {return false;}
                    var data = arg.side.data;
                    var trackParam = arg.side.trackParam;

                    var randomStr = util.getStr();
                    var $rightDiv = domClass.createDivElem(randomStr + '-side');
                    var $leftDiv = domClass.createDivElem(randomStr + '-side');
                    var $rightA = domClass.createAElem(data.url, data.imgurl_right, data.title);
                    var $leftA = domClass.createAElem(data.url, data.imgurl_left, data.title);
                    var $rightSpan = domClass.createSpanElem();
                    var $leftSpan = domClass.createSpanElem();

                    var style = {
                        height: '400px',
                        display: 'none',
                        width: '110px',
                        position: 'fixed',
                        top: '150px',
                        zIndex: 9999
                    };

                    if (ieVersion && ieVersion === 6) {
                        style.position = 'absolute';
                    }

                    $rightSpan.css({bottom: 0, left: 0}).appendTo($rightA);
                    $leftSpan.css({bottom: 0, right: 0}).appendTo($leftA);

                    $rightDiv.attr('data-hook', 'slide-down').css($.extend({right: 0}, style)).append($rightA);
                    $leftDiv.attr('data-hook', 'slide-down').css($.extend({left: 0}, style)).append($leftA);

                    $('body').append($rightDiv).append($leftDiv)

                    $('.' + randomStr + '-side').on('click', '[action-type=close]', function () {
                        util.log(trackParam);
                        $('.' + randomStr + '-side').remove();
                        util.cookieExpires({
                            key: window.pageId + '-side',
                            value: 1,
                            time: data.cktime
                        })
                        return false;
                    }).on('click', 'a', function(){
                        var param = $.extend({}, trackParam);
                        delete param.btnclose;
                        util.log(param);
                    });

                    util.loadImg(data.imgurl_left, $leftDiv);
                    util.loadImg(data.imgurl_right, $rightDiv);
                    if (ieVersion && ieVersion === 6) {
                        $(window).scroll(function () {
                            $rightDiv.css('top', $(window).scrollTop() + $(window).height() - 410 + 'px');
                            $leftDiv.css('top', $(window).scrollTop() + $(window).height() - 410 + 'px');
                        });
                    }
                },
                bottom: function(arg) {
                    // if (ieVersion && ieVersion === 6) {return false;}
                    var data = arg.bottom.data;
                    var trackParam = arg.bottom.trackParam;
                    var $tool = (function () {
                        var $icon = $('<i>');
                        var $title = $('<em>');
                        var $close = $('<a>');
                        var $tool = domClass.createDivElem();
                        
                        $icon.css({
                            display: 'inline-block',
                            width: '25px',
                            height: '25px',
                            verticalAlign: 'top',
                            marginRigth: '5px',
                            background: 'url(' + ICON + ') no-repeat -56px -26px'
                        });
                        $title.css({
                            display: 'inline-block',
                            height: '25px',
                            lineHeight: '25px',
                            verticalAlign: 'top',
                            fontSize: '12px',
                            fontWeight: 'bold',
                            fontFamily: 'SimSun',
                            fontStyle: 'normal'
                        }).html('猜你喜欢');
                        $close.attr({
                            'class': 'tool-btn-close'
                        });

                        $tool.css({
                            width: '288px',
                            height: '25px',
                            borderBottom: '1px solid #eaeaea',
                            position: 'relative'
                        }).append($icon).append($title).append($close);

                        return $tool;
                    }());

                    var $openTool = $('<a href="" class="tool-open"><i></i><em>猜你喜欢</em></a>');

                    var $container = domClass.createDivElem();
                    var randomStr = util.getStr();
                    var $client = domClass.createDivElem();

                    var createStyle = function (id) {
                        var cssText = ''
                        + '#' + id + ' a {float:left;width:120px;font-size:12px;color:#666;line-height:24px;height:24px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis; font-family: STHeiti,"Microsoft Yahei",Arial,Simhei,Simsun,helvetica,sans-serif}'
                        + '#' + id + ' a.even {margin-left:16px;}'
                        + '#' + id + ' .' + id + '-big {height:100px;float:left;margin-bottom:16px;width:260px;position:relative;}'
                        + '#' + id + ' .' + id + '-big:hover div {text-decoration:underline;}'
                        + '#' + id + ' .' + id + '-small {float:left;overflow:hidden;height:80px;margin-bottom:16px;width:260px;line-height:21px;}'
                        + '#' + id + ' a div{float:left;width:170px;}'
                        + '#' + id + ' a h5{font-size:14px;font-weight:bold;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;color:#000;line-height:1;_line-height:1.2;height:21px;}'
                        + '#' + id + ' a h6{font-size:12px;color:#333;line-height:18px;white-space:normal; height56px;}'
                        + '#' + id + ' a:hover , #' + id + ' a:hover h5, #' + id + ' a:hover h6{color:#f50;text-decoration:underline;}'
                        + '#' + id + ' a img{vertical-align:bottom;}'
                        + '#' + id + ' .' + id + '-small img {height:80px;width:80px;float:left;margin-right:10px;}'
                        + '.tool-btn-close {background:url('+ICON+') no-repeat 0 0;width:25px;height:25px; position: absolute; top:0;right:0; cursor:pointer;}'
                        + '.tool-btn-close:hover {background-position:-26px 0;}'
                        + '.tool-open {background-color:#7a7a7a;}'
                        + '.tool-open i, .tool-open em{float:left; height:20px;color:#fff;font-size:12px;line-height:20px;padding:0 3px;cursor:pointer;}'
                        + '.tool-open i {width:17px; background:url('+ICON+') no-repeat 0 -26px; padding: 0;}'
                        + '.tool-open:hover i{background-color:#666;}';
                        domClass.createStyleElem(cssText);
                    };

                    $client.css({
                        padding: '20px 14px 14px 14px',
                        width: '260px',
                        overflow: 'hidden'
                    }).attr('id', randomStr);
                    var openToolSty = {
                        position: 'fixed',
                        bottom: 1,
                        right: 1,
                        zIndex: 9999999,
                        display: 'none',
                        overflow: 'hidden'
                    };
                    var sty = {
                        position: 'fixed',
                        bottom: '1px',
                        right: '1px',
                        border: '1px solid #eaeaea',
                        height: '228px',
                        backgroundColor: '#fff',
                        fontSize: '14px',
                        zIndex: 9999999,
                        overflow: 'hidden'
                    };
                    if (ieVersion && ieVersion === 6) {
                        sty.position = 'absolute';
                        sty.bottom = 'auto';
                        sty.top = $(window).scrollTop() + $(window).height() - 233 + 'px';
                        openToolSty.position = 'absolute';
                        openToolSty.bottom = 'auto';
                        openToolSty.top = $(window).scrollTop() + $(window).height() - 23 + 'px';
                    }
                    $container.css(sty).append($tool).append($client);
                    $openTool.css(openToolSty).appendTo('body');

                    createStyle(randomStr);

                    var list = data.data;
                    var html= '';
                    if (data.style == '1') {
                        html += ''
                            +   '<a href="' + list[0].url + '" target="_blank" title="' + list[0].title + '" class="' + randomStr + '-big">'
                            +       '<img src="' + (HAO.https ? HAO.httpsTrans(list[0].imgurl) : list[0].imgurl) + '">'
                            +       '<div style="height:30px;width:260px;position:absolute;left:0;bottom:0;z-index:2;background:#000;opacity:.6;filter:alpha(opacity=60);"></div>'
                            +       '<div style="text-align:center;height:30px;line-height:30px;width:260px;position:absolute;left:0;bottom:0;z-index:5;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;color:#fff;font-size:14px;">' + list[0].title + '</div>'
                            +   '</a>';
                    }
                    else {
                        html += ''
                            +   '<a href="' + list[0].url + '" target="_blank" title="' + list[0].title + '" class="' + randomStr + '-small">'
                            +       '<img src="' + (HAO.https ? HAO.httpsTrans(list[0].imgurl) : list[0].imgurl) + '">'
                            +       '<div>'
                            +           '<h5>' + list[0].title + '</h5>'
                            +           '<h6>' + list[0].intro + '</h6>'
                            +       '</div>'
                            +   '</a>';
                    }
                    for (var i = 1, len = list.length; i < len; i++) {
                        html += '<a href="' + list[i].url + '" title="' + list[i].title + '" target="_blank"' + (i%2 === 0 ? 'class="even"' : '') + '>&bull;&nbsp;' + list[i].title + '</a>';
                    }
                    $container.on('click', '.tool-btn-close', function (e) {
                        e.preventDefault();
                        $container.animate({
                            opacity: 0
                        }, 'easing', function () {
                            $container.hide();
                        });
                        $openTool.show().animate({
                            opacity: 1
                        }, 'easing');
                        trackParam.title = '关闭';
                        trackParam.btnclose.replace('-open-', '-close-');
                        util.log(trackParam);
                    })
                    .on('click', 'div[id] a', function() {
                        var tmpTrack = $.extend({}, trackParam);
                        delete tmpTrack.btnclose;
                        tmpTrack.title = $(this).attr('title');
                        util.log(tmpTrack);
                    });
                    $openTool.click(function (e) {
                        e.preventDefault();
                        $openTool.animate({
                            opacity: 0
                        }, 'easing', function () {
                            $openTool.hide();
                        })
                        $container.show().animate({
                            opacity: 1
                        }, 'easing');
                        trackParam.title = '打开';
                        trackParam.btnclose.replace('-close-', '-open-');
                        util.log(trackParam);
                    });
                    $client.html(html);
                    $('body').append($container);
                    if (ieVersion && ieVersion === 6) {
                        $(window).scroll(function () {
                            $container.css('top', $(window).scrollTop() + $(window).height() - 233 + 'px');
                            $openTool.css('top', $(window).scrollTop() + $(window).height() - 23 + 'px');
                        });
                    }
                }
            };

            $(function () {
                var searches = location.search.split('&');
                var reviewTime;
                $.each(searches, function (i, v) {
                    if (v.indexOf('review_time') >= 0) {
                        reviewTime = decodeURIComponent(v.replace(/^.+=/, ''));
                    }
                });
                // location.search.match(/(?:review_time=([\d]{4}\/[\d]{1,2}\/[\d]{1,2}))/) ? RegExp.$1 : '';
                var param = reviewTime ? {page: window.pageId, review_time: reviewTime} : {page: window.pageId};
                $.ajax({
                    url: url(),
                    data: param,
                    dataType: 'jsonp',
                    crossDomain: true
                }).done(function (res) {
                    var vpParam = {};
                    if (res.err_no === 1) {
                        for (var key in res.data) {
                            vpParam = $.extend({}, res.data[key].trackParam);
                            if (key === 'top' && !util.getCookie(window.pageId + '-top')) {
                                adv.top(res.data);
                                vpParam = $.extend({}, res.data[key].trackParam);
                                delete vpParam.monkey;
                                delete vpParam.btnclose;
                                util.log(vpParam);
                            }
                            else if (key === 'side' && !util.getCookie(window.pageId + '-side') && window.screen.width >= 1440) {
                                adv.side(res.data);
                                vpParam = $.extend({}, res.data[key].trackParam);
                                delete vpParam.monkey;
                                delete vpParam.btnclose;
                                util.log(vpParam);
                            }
                            else if (key === 'bottom' && $(window).width() > 1190) {
                                adv.bottom(res.data);
                                vpParam = $.extend({}, res.data[key].trackParam);
                                delete vpParam.monkey;
                                delete vpParam.btnclose;
                                util.log(vpParam);
                            }
                            else {
                                grayFun();
                            }
                        }
                    }
                    else {
                        grayFun();
                    }
                });
            });

        })(window.jQuery || window.$);
    }
}, 50);

})();
